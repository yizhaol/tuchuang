(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5140:function(e,t,s){Promise.resolve().then(s.bind(s,7638))},7638:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return F}});var a=s(7437),l=s(2265),r=s(5017),i=s(6329),n=s(2896),o=s(3521),d=s(4833);function c(e){let{onFilesSelected:t,maxUploadCount:s}=e,r=(0,l.useRef)(null);return(0,a.jsxs)("div",{className:"drop-zone mb-6 flex flex-col items-center justify-center cursor-pointer",onDrop:e=>{e.preventDefault(),t(Array.from(e.dataTransfer.files))},onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("active")},onDragLeave:e=>{e.preventDefault(),e.currentTarget.classList.remove("active")},children:[(0,a.jsx)("div",{className:"mb-4 bg-indigo-100 dark:bg-indigo-900/50 p-4 rounded-full",children:(0,a.jsx)(d.rG,{className:"h-10 w-10 text-indigo-500"})}),(0,a.jsx)("p",{className:"text-lg font-medium mb-2",children:"拖放多张图片到这里"}),(0,a.jsx)("p",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary mb-4",children:"或者点击选择文件（可多选）"}),(0,a.jsxs)("p",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary mb-4",children:["最多可选择 ",s," 张图片"]}),(0,a.jsx)("input",{type:"file",ref:r,className:"hidden",accept:"image/*",multiple:!0,onChange:e=>{let s=e.target.files;s&&t(Array.from(s))}}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null===(e=r.current)||void 0===e?void 0:e.click()},className:"btn-primary px-4 py-2",children:"选择图片"})]})}function x(e){let{onChange:t}=e,[s,r]=(0,l.useState)("never"),[i,n]=(0,l.useState)(1),[o,c]=(0,l.useState)("hours");return(0,l.useEffect)(()=>{t(0)},[t]),(0,a.jsxs)("div",{className:"mb-6 flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.T3,{className:"h-5 w-5 mr-2 text-indigo-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"过期时间："})]}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("select",{value:s,onChange:e=>{let s=e.target.value;r(s);let a=0;switch(s){case"never":a=0;break;case"1m":a=1;break;case"1h":a=60;break;case"24h":a=1440;break;case"7d":a=10080;break;case"30d":a=43200;break;case"custom":a="minutes"===o?i:60*i}t(a)},className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-sm shadow-sm",children:[(0,a.jsx)("option",{value:"never",children:"永不过期"}),(0,a.jsx)("option",{value:"1m",children:"1分钟"}),(0,a.jsx)("option",{value:"1h",children:"1小时"}),(0,a.jsx)("option",{value:"24h",children:"1天"}),(0,a.jsx)("option",{value:"7d",children:"7天"}),(0,a.jsx)("option",{value:"30d",children:"30天"}),(0,a.jsx)("option",{value:"custom",children:"自定义"})]})}),"custom"===s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-24",children:(0,a.jsx)("input",{type:"number",min:"1",value:i,onChange:e=>{let a=parseInt(e.target.value);!isNaN(a)&&a>0&&(n(a),"custom"===s&&t("minutes"===o?a:60*a))},className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-center font-medium shadow-sm","aria-label":"自定义时间值"})}),(0,a.jsx)("div",{className:"w-24",children:(0,a.jsxs)("select",{value:o,onChange:e=>{let a=e.target.value;c(a),"custom"===s&&t("minutes"===a?i:60*i)},className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-sm shadow-sm",children:[(0,a.jsx)("option",{value:"minutes",children:"分钟"}),(0,a.jsx)("option",{value:"hours",children:"小时"})]})})]})]})}function m(e){let{selectedTags:t,availableTags:s,onTagsChange:r,onNewTagCreated:i}=e,[n,o]=(0,l.useState)(""),c=e=>{r(t.filter(t=>t!==e))},x=()=>{n.trim()&&!t.includes(n.trim())&&(r([...t,n.trim()]),o(""),i&&i())};return(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(d.lO,{className:"h-5 w-5 mr-2 text-indigo-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"标签："})]}),(0,a.jsxs)("div",{className:"flex-1 flex space-x-2",children:[(0,a.jsxs)("select",{onChange:e=>{let s=e.target.value;s&&!t.includes(s)&&r([...t,s]),e.target.value=""},value:"",className:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-sm shadow-sm",children:[(0,a.jsx)("option",{value:"",children:"选择标签..."}),s.filter(e=>!t.includes(e)).map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("input",{type:"text",value:n,onChange:e=>{o(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),x())},placeholder:"自定义标签",className:"px-3 py-2 rounded-l-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-slate-800 text-gray-700 dark:text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-600 text-sm shadow-sm"}),(0,a.jsx)("button",{type:"button",onClick:x,className:"px-3 py-2 rounded-r-lg bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-medium transition-colors duration-200 text-sm flex items-center",children:(0,a.jsx)(d.pO,{className:"h-4 w-4"})})]})]})]}),t.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:t.map(e=>(0,a.jsxs)("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 text-white px-3 py-1 rounded-full text-sm font-medium flex items-center shadow-sm",children:[(0,a.jsx)("span",{children:e}),(0,a.jsx)("button",{type:"button",onClick:()=>c(e),className:"ml-1.5 rounded-full p-0.5 hover:bg-white/20 transition-colors",children:(0,a.jsx)(d.yp,{className:"h-3.5 w-3.5"})})]},e))})]})}function u(e){let{onUpload:t,isUploading:s,maxUploadCount:r=10,onFilesSelected:n,onTogglePreview:o,isPreviewOpen:u,fileCount:h=0,existingFiles:g=[],expiryMinutes:p,setExpiryMinutes:f,onTagsChange:b}=e,[j,v]=(0,l.useState)([]),[y,N]=(0,l.useState)([]),[k,w]=(0,l.useState)(!1),[C,S]=(0,l.useState)(!1),[E,T]=(0,l.useState)([]),[F,M]=(0,l.useState)([]),D=async()=>{try{let e=await i.hi.get("/api/tags");e.tags&&e.tags.length>0&&M(e.tags)}catch(e){console.error("获取标签失败:",e)}};(0,l.useEffect)(()=>{D()},[]),(0,l.useEffect)(()=>{k&&!s&&(v([]),N([]),S(!1)),w(s)},[s,k]),(0,l.useEffect)(()=>{0===h&&j.length>0&&(v([]),N([]),S(!1))},[h]),(0,l.useEffect)(()=>{g.length>0&&(v(g.map(e=>e.file)),N(g))},[g]);let P=async e=>{e.preventDefault(),0!==j.length&&await t(j,p,E)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"card p-8 mb-8",children:[(0,a.jsxs)("h2",{className:"text-2xl font-semibold mb-6 flex items-center",children:[(0,a.jsx)(d.rG,{className:"h-6 w-6 mr-2 text-indigo-500"}),"上传图片"]}),(0,a.jsxs)("form",{onSubmit:P,children:[(0,a.jsx)(c,{onFilesSelected:e=>{let t=[...j],s=[...t],a=[...y];for(let l of e)t.some(e=>e.name===l.name&&e.size===l.size&&e.lastModified===l.lastModified)||(s.push(l),a.push({id:Math.random().toString(36).substring(2,11),file:l}));if(s.length>r){let e=s.slice(0,r),t=a.slice(0,r);v(e),N(t),S(!0),n&&n(t)}else v(s),N(a),S(!1),n&&n(a)},maxUploadCount:r}),(0,a.jsx)(x,{onChange:f}),(0,a.jsx)(m,{selectedTags:E,availableTags:F,onTagsChange:e=>{T(e),b&&b(e)},onNewTagCreated:D}),C&&(0,a.jsx)("div",{className:"mb-6 p-4 rounded-xl bg-gradient-to-r from-amber-50 to-yellow-50 dark:from-amber-900/20 dark:to-yellow-900/20 border border-amber-200 dark:border-amber-800 shadow-sm",children:(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"bg-amber-100 dark:bg-amber-900/30 p-2 rounded-full mr-3 flex-shrink-0",children:(0,a.jsx)(d.LP,{className:"h-5 w-5 text-amber-500"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-amber-700 dark:text-amber-300 mb-1",children:"超出上传限制"}),(0,a.jsxs)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:["一次最多只能上传 ",(0,a.jsx)("span",{className:"font-medium",children:r})," 张图片。已自动选择前 ",r," 张。"]})]})]})}),j.length>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary",children:["已选择 ",(0,a.jsx)("span",{className:"font-medium text-indigo-600 dark:text-indigo-400",children:j.length})," 张图片"]}),o&&(0,a.jsxs)("button",{type:"button",onClick:o,className:"px-4 py-2 text-sm bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900/20 dark:hover:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-lg transition-colors duration-200 flex items-center font-medium",children:[(0,a.jsx)(d.XB,{className:"h-4 w-4 mr-1.5"}),u?"隐藏文件列表":"查看文件列表"]})]})]})]})})}function h(e){let{progress:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"bg-light-bg-primary dark:bg-dark-bg-primary rounded-xl overflow-hidden mb-4",children:(0,a.jsx)("div",{className:"h-2 bg-gradient-primary transition-all duration-300",style:{width:"".concat(t,"%")}})}),(0,a.jsxs)("p",{className:"text-sm text-light-text-secondary dark:text-dark-text-secondary text-center",children:["上传进度: ",Math.round(t),"%"]})]})}var g=s(3145),p=s(8614),f=s(9597),b=s(3594);function j(e){var t;let{image:s}=e,l=(0,b.m)((null===(t=s.urls)||void 0===t?void 0:t.webp)||"");return(0,a.jsx)("div",{className:"w-full md:w-2/5 p-4 md:border-r border-slate-200 dark:border-slate-700 flex items-center",children:(0,a.jsx)(f.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"relative w-full h-full overflow-hidden rounded-lg border border-slate-200 dark:border-slate-700",style:{height:"400px"},children:(0,a.jsx)(g.default,{src:l,alt:s.filename,fill:!0,sizes:"(max-width: 768px) 100vw, 400px",className:"object-contain"})})})}function v(e){let{image:t}=e;return(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[t.format&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"原始格式:"}),(0,a.jsx)("span",{className:"text-sm bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded",children:t.format.toUpperCase()})]}),t.orientation&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"图片方向:"}),(0,a.jsx)("span",{className:"text-sm bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded capitalize",children:t.orientation})]}),t.expiryTime&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"过期时间:"}),(0,a.jsx)("span",{className:"text-sm bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 px-2 py-0.5 rounded",children:new Date(t.expiryTime).toLocaleString()})]})]})})}var y=s(1214);function N(e){let{title:t,url:s,icon:l,iconColor:r,copyType:i,copyStatus:n,onCopy:o}=e;return(0,a.jsxs)(f.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:r,children:l}),(0,a.jsx)("div",{className:"font-medium",children:t})]}),(0,a.jsxs)("div",{className:"rounded-lg bg-slate-100 dark:bg-slate-900 flex items-center group relative hover:bg-slate-200 dark:hover:bg-slate-800/80 transition-colors duration-200",children:[(0,a.jsx)("div",{className:"flex-1 px-4 py-3 text-sm font-mono overflow-hidden text-ellipsis",children:s}),(0,a.jsxs)("button",{onClick:e=>o(s,i,e),className:"p-3 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-r-lg transition-colors duration-200 relative",title:"复制链接",children:[n&&n.type===i?(0,a.jsx)(d.nQ,{className:"h-5 w-5 text-green-500"}):(0,a.jsx)(d.TI,{className:"h-5 w-5"}),n&&n.type===i&&(0,a.jsx)("span",{className:"absolute -top-8 right-0 bg-black/70 text-white text-xs rounded px-2 py-1",children:"已复制!"})]})]})]})}function k(e){var t,s,r;let{image:i}=e,[n,o]=(0,l.useState)(null),c=(e,t,s)=>{s&&s.stopPropagation(),(0,y.v)(e).then(e=>{e?(o({type:t}),setTimeout(()=>{o(null)},2e3)):console.error("复制失败")}).catch(e=>{console.error("复制失败:",e)})},x=(0,b.m)((null===(t=i.urls)||void 0===t?void 0:t.original)||""),m=(0,b.m)((null===(s=i.urls)||void 0===s?void 0:s.webp)||""),u=(0,b.m)((null===(r=i.urls)||void 0===r?void 0:r.avif)||"");return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(N,{title:"原始图片",url:x,icon:(0,a.jsx)(d.XB,{className:"h-5 w-5"}),iconColor:"text-blue-500",copyType:"original",copyStatus:n,onCopy:c}),m&&(0,a.jsx)(N,{title:"WebP 格式",url:m,icon:(0,a.jsx)(d.aA,{className:"h-5 w-5"}),iconColor:"text-purple-500",copyType:"webp",copyStatus:n,onCopy:c}),u&&(0,a.jsx)(N,{title:"AVIF 格式",url:u,icon:(0,a.jsx)(d.aA,{className:"h-5 w-5"}),iconColor:"text-green-500",copyType:"avif",copyStatus:n,onCopy:c}),(0,a.jsx)(N,{title:"Markdown 格式",url:"![".concat(i.filename,"](").concat(x,")"),icon:(0,a.jsx)(d.Dr,{className:"h-5 w-5"}),iconColor:"text-amber-500",copyType:"markdown",copyStatus:n,onCopy:c})]})}function w(e){let{image:t,onDelete:s}=e,[r,i]=(0,l.useState)(!1),[n,o]=(0,l.useState)(!1),c=async()=>{try{var e;o(!0);let a=t.id;if(!a&&(null===(e=t.urls)||void 0===e?void 0:e.original)){let e=t.urls.original.split("/");a=e[e.length-1].split(".")[0]}if(!a)throw Error("无法获取图像ID");await s(a),i(!1)}catch(e){console.error("删除失败:",e)}finally{o(!1)}};return r?(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>i(!1),className:"px-3 py-2 border border-slate-200 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors text-sm",disabled:n,children:"取消"}),(0,a.jsx)("button",{onClick:c,className:"px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors text-sm flex items-center",disabled:n,children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.$j,{className:"-ml-1 mr-2 h-4 w-4 text-white"}),"处理中"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.XH,{className:"h-4 w-4 mr-1"}),"确认删除"]})})]}):(0,a.jsxs)("button",{onClick:()=>i(!0),className:"px-4 py-2 text-red-600 dark:text-red-400 border border-red-200 dark:border-red-800 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors font-medium flex items-center",children:[(0,a.jsx)(d.XH,{className:"h-4 w-4 mr-2"}),"删除图片"]})}function C(e){let{isOpen:t,onClose:s,image:l,onDelete:r}=e,i=async e=>{if(r)try{await r(e),s()}catch(e){console.error("删除失败:",e)}};return l&&"success"===l.status&&l.urls?(0,a.jsx)(p.M,{children:t&&(0,a.jsx)(f.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:s,children:(0,a.jsxs)(f.E.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white dark:bg-slate-800 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:l.filename}),(0,a.jsx)("button",{onClick:s,className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-full transition-colors",children:(0,a.jsx)(d.yp,{className:"h-6 w-6"})})]}),(0,a.jsx)("div",{className:"overflow-y-auto max-h-[calc(90vh-5rem)]",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,a.jsx)(j,{image:l}),(0,a.jsxs)("div",{className:"flex-1 p-4",children:[(0,a.jsx)("h4",{className:"text-lg font-medium mb-4",children:"图片信息"}),(0,a.jsx)(v,{image:l}),(0,a.jsx)("h4",{className:"text-lg font-medium mb-4",children:"可用格式"}),(0,a.jsx)(k,{image:l})]})]})}),(0,a.jsxs)(f.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6},className:"p-4 border-t border-slate-200 dark:border-slate-700 flex justify-between",children:[r&&(0,a.jsx)(w,{image:l,onDelete:i}),(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded-lg transition-colors font-medium",children:"关闭"})]})]})})}):null}function S(e){let{isOpen:t,results:s,onClose:r,onDelete:i}=e,[n,o]=(0,l.useState)(null),[c,x]=(0,l.useState)(!1),[m,u]=(0,l.useState)("all"),h=s.filter(e=>"success"===e.status),j=s.filter(e=>"error"===e.status),v="all"===m?s:"success"===m?h:j,y=e=>{o(e),x(!0)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.M,{children:t&&(0,a.jsxs)(f.E.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed top-0 right-0 w-full sm:w-96 h-full bg-white dark:bg-slate-900 shadow-xl z-30 border-l border-slate-200 dark:border-slate-700 overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-indigo-500 to-purple-600 text-white",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold flex items-center",children:[(0,a.jsx)(d.XB,{className:"h-5 w-5 mr-2 text-white opacity-90"}),"媒体库 (",s.length,")"]}),(0,a.jsx)("button",{onClick:r,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:(0,a.jsx)(d.yp,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"flex border-b border-slate-200 dark:border-slate-700",children:[(0,a.jsxs)("button",{onClick:()=>u("all"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("all"===m?"text-indigo-600 dark:text-indigo-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["全部 (",s.length,")","all"===m&&(0,a.jsx)(f.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600 dark:bg-indigo-400"})]}),(0,a.jsxs)("button",{onClick:()=>u("success"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("success"===m?"text-green-600 dark:text-green-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["成功 (",h.length,")","success"===m&&(0,a.jsx)(f.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-green-600 dark:bg-green-400"})]}),(0,a.jsxs)("button",{onClick:()=>u("error"),className:"flex-1 py-3 px-4 text-sm font-medium transition-colors relative ".concat("error"===m?"text-red-600 dark:text-red-400":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200"),children:["失败 (",j.length,")","error"===m&&(0,a.jsx)(f.E.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-red-600 dark:bg-red-400"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===v.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-slate-500 dark:text-slate-400 p-6",children:[(0,a.jsx)(d.XB,{className:"h-16 w-16 mb-4 text-slate-300 dark:text-slate-600"}),(0,a.jsx)("p",{className:"text-lg font-medium mb-2",children:"暂无图片"}),(0,a.jsx)("p",{className:"text-sm",children:"all"===m?"上传完成的图片将会显示在这里":"success"===m?"没有成功上传的图片":"没有上传失败的图片"})]}):(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3",children:v.map((e,t)=>{var s;return(0,a.jsx)(f.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.05*t},className:"relative rounded-lg overflow-hidden border ".concat("success"===e.status?"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800":"border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/20"," shadow-sm hover:shadow-md transition-all cursor-pointer group"),onClick:()=>"success"===e.status&&y(e),children:"success"===e.status?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"aspect-square relative bg-slate-50 dark:bg-slate-900",children:[(null===(s=e.urls)||void 0===s?void 0:s.original)&&(0,a.jsx)(g.default,{src:(0,b.m)(e.urls.webp),alt:e.filename,fill:!0,className:"object-cover group-hover:scale-105 transition-transform duration-300",sizes:"(max-width: 768px) 50vw, 33vw"}),(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),(0,a.jsx)("div",{className:"absolute top-1 right-1",children:(0,a.jsx)("span",{className:"text-xs px-1.5 py-0.5 bg-green-500/80 text-white rounded-full",children:"完成"})}),(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-white transform translate-y-full group-hover:translate-y-0 transition-transform duration-300",children:[(0,a.jsx)("p",{className:"text-xs truncate",title:e.filename,children:e.filename}),e.expiryTime&&(0,a.jsx)("p",{className:"text-xs mt-1",children:(0,a.jsxs)("span",{className:"bg-yellow-500/80 text-white px-1 py-0.5 rounded text-[10px]",children:["过期时间:"," ",new Date(e.expiryTime).toLocaleString()]})})]})]})}):(0,a.jsx)("div",{className:"p-3 h-full flex flex-col",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,a.jsx)(d.LP,{className:"h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-sm text-red-600 dark:text-red-400",children:e.filename}),(0,a.jsx)("p",{className:"text-xs text-red-500 dark:text-red-300 mt-1",children:e.message})]})]})})},e.id||"".concat(m,"-").concat(t))})})})})]})}),(0,a.jsx)(C,{image:n,isOpen:c,onClose:()=>{x(!1)},onDelete:i}),(0,a.jsx)(p.M,{children:t&&(0,a.jsx)(f.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/20 dark:bg-black/50 backdrop-blur-sm z-20 sm:block hidden",onClick:r})})]})}let E=e=>{if(0===e)return"0 B";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]};function T(e){let{files:t,onRemoveFile:s,onRemoveAll:l,isOpen:r,onClose:i,onUpload:n,isUploading:o}=e;return(0,a.jsx)(p.M,{children:r&&(0,a.jsxs)(f.E.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"fixed top-0 right-0 w-full sm:w-96 h-full bg-indigo-100/10 dark:bg-slate-800/20 shadow-xl z-30 border-l border-slate-200/50 dark:border-slate-700/50 overflow-hidden flex flex-col",style:{backdropFilter:"blur(12px)"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-slate-200/50 dark:border-slate-700/50 bg-indigo-600 text-white",children:[(0,a.jsxs)("h2",{className:"text-lg font-semibold flex items-center",children:[(0,a.jsx)(d.XB,{className:"h-5 w-5 mr-2 text-white opacity-90"}),"待上传图片 (",t.length,")"]}),(0,a.jsx)("button",{onClick:i,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:(0,a.jsx)(d.yp,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:0===t.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center text-slate-500 dark:text-slate-400 p-6",children:[(0,a.jsx)(d.XB,{className:"h-16 w-16 mb-4 text-slate-300 dark:text-slate-600"}),(0,a.jsx)("p",{className:"text-lg font-medium mb-2",children:"暂无文件"}),(0,a.jsx)("p",{className:"text-sm",children:"选择要上传的文件后会显示在这里"})]}):(0,a.jsx)("div",{className:"space-y-3",children:t.map((e,t)=>(0,a.jsxs)(f.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"group flex items-center p-3 bg-slate-200/50 dark:bg-slate-700/30 rounded-lg border border-slate-300/30 dark:border-slate-600/30 hover:bg-slate-200/80 dark:hover:bg-slate-700/50 transition-all duration-200",children:[(0,a.jsx)("div",{className:"flex-shrink-0 mr-3",children:(0,a.jsx)("div",{className:"w-12 h-12 flex items-center justify-center overflow-hidden bg-indigo-100 dark:bg-indigo-900/20 rounded-lg",children:(0,a.jsx)(d.XB,{className:"h-8 w-8 text-indigo-400"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200 truncate",children:e.file.name}),(0,a.jsxs)("div",{className:"flex items-center mt-1",children:[(0,a.jsx)("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:E(e.file.size)}),e.file.type&&(0,a.jsx)("span",{className:"ml-2 text-xs text-slate-500 dark:text-slate-400",children:e.file.type.split("/")[1].toUpperCase()})]})]}),(0,a.jsx)("button",{onClick:()=>s(e.id),className:"flex-shrink-0 p-2 rounded-full text-slate-400 hover:text-red-500 dark:text-slate-500 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:(0,a.jsx)(d.XH,{className:"h-5 w-5"})})]},e.id))})}),t.length>0&&(0,a.jsx)("div",{className:"p-4 border-t border-slate-200/50 dark:border-slate-700/50 bg-slate-50/80 dark:bg-slate-800/50",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("button",{onClick:l,className:"px-4 py-2 flex items-center justify-center bg-white hover:bg-slate-100 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 rounded-lg transition-colors duration-200 font-medium border border-slate-200 dark:border-slate-600",children:[(0,a.jsx)(d.XH,{className:"h-4 w-4 mr-2"}),"清除全部"]}),(0,a.jsx)("button",{onClick:n,disabled:o,className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors duration-200 font-medium flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.$j,{className:"-ml-1 mr-2 h-5 w-5 text-white"}),"上传中..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.rG,{className:"h-5 w-5 mr-2"}),"开始上传"]})})]})})]})})}function F(){let[e,t]=(0,l.useState)(!1),[s,c]=(0,l.useState)(!1),[x,m]=(0,l.useState)(0),[g,p]=(0,l.useState)(null),[b,j]=(0,l.useState)([]),[v,y]=(0,l.useState)(!1),[N,k]=(0,l.useState)(!1),[w,C]=(0,l.useState)(!1),[E,F]=(0,l.useState)(10),[M,D]=(0,l.useState)([]),[P,z]=(0,l.useState)([]),[B,I]=(0,l.useState)(0);(0,l.useEffect)(()=>{b.length>0&&!v&&(y(!0),k(!1))},[b]),(0,l.useEffect)(()=>{M.length>0&&!N?k(!0):0===M.length&&k(!1)},[M]),(0,l.useEffect)(()=>{(async()=>{let e=(0,r.Pi)();if(!e){t(!0),C(!1);return}await (0,r.Gw)(e)?C(!0):(t(!0),C(!1),p({type:"error",message:"API Key无效,请重新验证"}))})()},[]),(0,l.useEffect)(()=>{(async()=>{try{let e=await i.hi.request("/api/config");F(e.maxUploadCount)}catch(e){console.error("Failed to fetch config:",e),F(10)}})()},[]);let X=async()=>{let e=M.map(e=>e.file);if(0!==e.length){if(!(0,r.Pi)()){t(!0);return}c(!0),m(0),p(null);try{let t=setInterval(()=>{m(e=>e>=90?(clearInterval(t),e):e+5)},300),s=new FormData;e.forEach(e=>{s.append("images[]",e)}),s.append("expiryMinutes",B.toString()),P.length>0&&s.append("tags",P.join(","));let a=await i.hi.request("/api/upload",{method:"POST",body:s});clearInterval(t),m(100);let l=a.results.map(e=>{var t,s;let a=Math.random().toString(36).substring(2),l=(null===(t=e.urls)||void 0===t?void 0:t.original)||"";if(null===(s=e.urls)||void 0===s?void 0:s.original){let t=e.urls.original.split("/"),s=t[t.length-1];s.includes(".")&&(a=s.split(".")[0])}return{...e,id:a,path:l}});j(l);let r=l.filter(e=>"success"===e.status).length,n=l.filter(e=>"error"===e.status).length,o=l.length;p({type:0===n?"success":"warning",message:"上传完成：共".concat(o,"张，").concat(r,"张成功，").concat(n,"张失败")}),D([])}catch(t){let e="上传失败，请重试";t instanceof Error&&(e=t.message.includes("超过最大上传数量")||t.message.includes("maximum upload")?"上传失败：超过最大上传数量限制（".concat(E,"张图片）"):"上传失败：".concat(t.message)),p({type:"error",message:e})}finally{c(!1),setTimeout(()=>m(0),1e3)}}},O=async e=>{try{var t;let s=b.find(t=>t.id===e);if(!s||!(null===(t=s.urls)||void 0===t?void 0:t.original))return;let a=s.urls.original.split("/"),l=a[a.length-1].split(".")[0],r=await i.hi.post("/api/delete-image",{id:l});r.success?(j(t=>t.filter(t=>t.id!==e)),b.length<=1&&y(!1),p({type:"success",message:r.message})):p({type:"error",message:r.message})}catch(e){console.error("删除失败:",e),p({type:"error",message:"删除失败，请重试"})}};return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-8",style:{margin:"0 auto"},children:[(0,a.jsx)(o.Z,{onApiKeyClick:()=>t(!0),isKeyVerified:w}),(0,a.jsx)(u,{onUpload:X,isUploading:s,maxUploadCount:E,onFilesSelected:e=>{D(e)},onTogglePreview:()=>{k(!N)},isPreviewOpen:N,fileCount:M.length,existingFiles:M,expiryMinutes:B,setExpiryMinutes:I,onTagsChange:e=>{z(e)}}),b.length>0&&!v&&(0,a.jsx)(f.E.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},whileHover:{scale:1.1},onClick:()=>y(!0),className:"fixed bottom-6 right-6 bg-indigo-600 dark:bg-indigo-500 text-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all z-20 flex items-center justify-center",title:"查看已上传图片",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d.XB,{className:"h-6 w-6"}),(0,a.jsx)("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:b.length})]})}),M.length>0&&!N&&(0,a.jsx)(f.E.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},whileHover:{scale:1.1},onClick:()=>k(!0),className:"fixed bottom-20 right-6 bg-indigo-500 dark:bg-indigo-400 text-white rounded-full p-3 shadow-lg hover:shadow-xl transition-all z-20 flex items-center justify-center",title:"查看待上传图片",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d.SP,{className:"h-6 w-6"}),(0,a.jsx)("span",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:M.length})]})}),s&&(0,a.jsx)(h,{progress:x}),(0,a.jsx)(S,{isOpen:v,results:b,onClose:()=>y(!1),onDelete:O}),(0,a.jsx)(T,{files:M,onRemoveFile:e=>{let t=M.filter(t=>t.id!==e);D(t),0===t.length&&k(!1)},onRemoveAll:()=>{D([]),k(!1)},isOpen:N,onClose:()=>k(!1),onUpload:X,isUploading:s}),(0,a.jsx)(n.Z,{isOpen:e,onClose:()=>t(!1),onSuccess:e=>{(0,r.Lb)(e),t(!1),C(!0),p({type:"success",message:"API Key验证成功！"})}})]})}}},function(e){e.O(0,[832,75,971,117,744],function(){return e(e.s=5140)}),_N_E=e.O()}]);